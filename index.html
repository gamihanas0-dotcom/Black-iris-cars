<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLACK IRIS cars - Rent in Morocco</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="data.js"></script>
    <style>
        /* Custom Font Poppins */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #fafafa;
            transition: all 0.3s ease; /* For smooth RTL transition */
        }
        /* Monochrome Theme Colors + Royal Blue Accent */
        .primary-dark { background-color: #1a1a1a; } /* Blacker Black */
        .text-primary-dark { color: #1a1a1a; } /* Blacker Black */
        .accent-blue { background-color: #4169e1; } /* Royal Blue */
        .hover\:accent-blue-dark:hover { background-color: #2b4daa; } /* Darker Royal Blue */
        .text-accent-blue { color: #4169e1; }

        #hero-section {
            background-image: url('https://placehold.co/1200x600/1a1a1a/ffffff?text=BLACK+IRIS+CARS+-+Morocco'); /* Updated background color */
            background-size: cover;
            background-position: center;
        }
        /* Icon color uses the dark text color */
        .feature-icon { color: #1a1a1a; }

        /* CRITICAL: Ensure inputs are visible (black text) and consistent padding */
        input[type="date"], select {
            color: #000000 !important;
            background-color: #ffffff !important;
            padding: 8px 12px !important; 
            height: 44px; 
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }
        /* Style for input calendar icon (kept for consistency, though 'date' type behavior varies) */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0); 
        }
        /* Ensure selected city option text is black */
        select option { color: #000000; }

        /* RTL adjustments for Arabic */
        [dir="rtl"] .ltr\:mr-2 { margin-right: 0; margin-left: 0.5rem; }
        [dir="rtl"] .ltr\:text-left { text-align: right; }
        [dir="rtl"] .ltr\:justify-start { justify-content: flex-end; }
        [dir="rtl"] .md\:ltr\:space-x-8 > * + * { margin-left: 0; margin-right: 2rem; }
        [dir="rtl"] .ltr\:ml-1 { margin-left: 0; margin-right: 0.25rem; }

        /* Modal specific styling for animation */
        #car-detail-modal {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Language Selector custom size */
        #language-selector {
            padding: 4px 8px !important; /* Smaller padding */
            font-size: 0.75rem !important; /* text-xs */
        }

        /* Specific styles for contact buttons */
        .btn-whatsapp-green { background-color: #128C7E; }
        .hover\:btn-whatsapp-dark:hover { background-color: #075E54; }
        .btn-email-blue { background-color: #4169e1; }
        .hover\:btn-email-dark:hover { background-color: #2b4daa; }
    </style>
</head>
<body class="antialiased" dir="ltr">

    <header class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="#" class="flex items-center">
                    <img src="https://i.postimg.cc/B6LWwXNL/923d79fe-5117-4849-9761-57e1fe5a8d96.jpg" alt="BLACK IRIS cars Logo" class="w-10 h-10 mr-2 rounded-full border border-gray-100">
                    <span class="text-2xl font-extrabold text-primary-dark">BLACK IRIS cars</span>
                </a>

                <div class="flex items-center space-x-4">
                    <select id="language-selector" class="rounded-md border-gray-300 focus:ring-primary-dark focus:border-primary-dark text-primary-dark">
                        <option value="en">English</option>
                        <option value="fr">Français</option>
                        <option value="ar">العربية</option>
                    </select>

                    <nav class="hidden md:flex ltr:mr-2 md:ltr\:space-x-8">
                        <a href="#featured" class="text-gray-600 hover:text-accent-blue transition duration-150" data-i18n="nav-fleet">Our Fleet</a>
                        <a href="#why-us" class="text-gray-600 hover:text-accent-blue transition duration-150" data-i18n="nav-why">Why Choose Us</a>
                        <a href="#testimonials" class="text-gray-600 hover:text-accent-blue transition duration-150" data-i18n="nav-reviews">Reviews</a>
                        <a href="#contact" class="text-gray-600 hover:text-accent-blue transition duration-150" data-i18n="nav-contact">Contact</a>
                    </nav>

                    <button id="mobile-menu-button" class="md:hidden text-gray-600 hover:text-accent-blue p-2 rounded-lg transition duration-150">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#featured" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50 hover:text-accent-blue" data-i18n="nav-fleet">Our Fleet</a>
                <a href="#why-us" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50 hover:text-accent-blue" data-i18n="nav-why">Why Choose Us</a>
                <a href="#testimonials" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50 hover:text-accent-blue" data-i18n="nav-reviews">Reviews</a>
                <a href="#contact" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50 hover:text-accent-blue" data-i18n="nav-contact">Contact</a>
            </div>
        </div>
    </header>

    <section id="hero-section" class="py-20 md:py-32 relative text-white">
        <div class="absolute inset-0 primary-dark opacity-70"></div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="text-center">
                <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight mb-4" data-i18n="h1-hero">
                    Explore Morocco. Drive Quality.
                </h1>
                <p class="text-xl sm:text-2xl font-light mb-8" data-i18n="p-hero">
                    Premium cars available across all major Moroccan cities.
                </p>
            </div>

            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl mt-10 max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-6" data-i18n="h2-reservation">Quick Reservation</h2>
                <form id="rental-form" class="space-y-4 md:space-y-0 md:grid md:grid-cols-5 md:gap-4">
                    <div class="col-span-2">
                        <label for="location" class="block text-sm font-medium text-gray-700" data-i18n="label-pickup-city">Pick-up City or Airport</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <select id="location" name="location" required class="block w-full rounded-lg border-gray-300 focus:ring-gray-700 focus:border-gray-700 border">
                                <option value="" data-i18n="select-location">Select a location</option>
                                <option value="Casablanca Airport">Casablanca Mohammed V Airport (CMN)</option>
                                <option value="Marrakech Airport">Marrakech Menara Airport (RAK)</option>
                                <option value="Tangier Airport">Tangier Ibn Battouta Airport (TNG)</option>
                                <option value="Agadir Airport">Agadir Al Massira Airport (AGA)</option>
                                <option value="Rabat Airport">Rabat–Salé Airport (RBA)</option>
                                <option value="Fes Airport">Fes-Saïss Airport (FEZ)</option>
                                <option value="Essaouira Airport">Essaouira-Mogador Airport (ESU)</option>
                                <option disabled>──────────</option>
                                <option value="Casablanca">Casablanca City</option>
                                <option value="Marrakech">Marrakech City</option>
                                <option value="Rabat">Rabat City</option>
                                <option value="Tangier">Tangier City</option>
                                <option value="Agadir">Agadir City</option>
                                <option value="Fes">Fes City</option>
                                <option value="Essaouira">Essaouira City</option>
                                <option value="Kenitra">Kenitra</option>
                                <option value="Meknes">Meknes</option>
                                <option value="Salé">Salé</option>
                                <option value="Temara">Temara</option>
                                <option value="Tetouan">Tetouan</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label for="pickup-date" class="block text-sm font-medium text-gray-700" data-i18n="label-pickup-date">Pick-up Date</label>
                        <input type="date" id="pickup-date" name="pickup-date" required class="mt-1 block w-full rounded-lg border-gray-300 focus:ring-gray-700 focus:border-gray-700 border">
                    </div>

                    <div>
                        <label for="return-date" class="block text-sm font-medium text-gray-700" data-i18n="label-return-date">Return Date</label>
                        <input type="date" id="return-date" name="return-date" required class="mt-1 block w-full rounded-lg border-gray-300 focus:ring-gray-700 focus:border-gray-700 border">
                    </div>

                    <div class="col-span-1 flex items-end">
                        <button type="submit" class="w-full accent-blue text-white font-semibold py-3 rounded-lg hover:accent-blue-dark transition duration-300 shadow-md" data-i18n="btn-search">
                            Search Cars
                        </button>
                    </div>
                </form>

                <div id="result-message" class="hidden mt-6 p-4 rounded-xl text-gray-700 transition duration-500 ease-in-out">
                    </div>
            </div>
        </div>
    </section>
    
    ---

    <section id="featured" class="py-16 md:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-primary-dark text-center mb-12" data-i18n="h2-fleet">
                Our Fleet
            </h2>

            <div id="featured-car-grid" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-5 xl:grid-cols-5 gap-4">
                </div>
            
            <div class="text-center mt-8">
                <a href="available_cars.html" id="view-all-cars-btn" class="accent-blue text-white font-semibold py-3 px-8 rounded-lg hover:accent-blue-dark transition duration-300 shadow-md" data-i18n="btn-view-all">
                    View All Cars
                </a>
            </div>
        </div>
    </section>

    ---
    
    <section id="why-us" class="py-16 md:py-24 primary-dark text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-center mb-12" data-i18n="h2-promise">
                The Black Iris Promise
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 text-center">
                <div class="p-6 rounded-xl bg-gray-800 shadow-xl border-t-4 border-gray-500">
                    <i data-lucide="key-round" class="w-12 h-12 mx-auto mb-4 text-accent-blue"></i>
                    <h3 class="text-xl font-semibold mb-2" data-i18n="pickup-title">Effortless Pickup</h3>
                    <p class="text-gray-400" data-i18n="pickup-desc">Fast service at all major Moroccan airports.</p>
                </div>
                <div class="p-6 rounded-xl bg-gray-800 shadow-xl border-t-4 border-gray-500">
                    <i data-lucide="shield-check" class="w-12 h-12 mx-auto mb-4 text-accent-blue"></i>
                    <h3 class="text-xl font-semibold mb-2" data-i18n="insured-title">Insured & Ready</h3>
                    <p class="text-gray-400" data-i18n="insured-desc">Comprehensive insurance included for peace of mind.</p>
                </div>
                <div class="p-6 rounded-xl bg-gray-800 shadow-xl border-t-4 border-gray-500">
                    <i data-lucide="headset" class="w-12 h-12 mx-auto mb-4 text-accent-blue"></i>
                    <h3 class="text-xl font-semibold mb-2" data-i18n="support-title">24/7 Local Support</h3>
                    <p class="text-gray-400" data-i18n="support-desc">Dedicated support line available around the clock.</p>
                </div>
                <div class="p-6 rounded-xl bg-gray-800 shadow-xl border-t-4 border-gray-500">
                    <i data-lucide="map" class="w-12 h-12 mx-auto mb-4 text-accent-blue"></i>
                    <h3 class="text-xl font-semibold mb-2" data-i18n="morocco-title">Morocco Ready</h3>
                    <p class="text-gray-400" data-i18n="morocco-desc">Vehicles maintained for all Moroccan terrains and climate.</p>
                </div>
            </div>
        </div>
    </section>

    ---

    <section id="testimonials" class="py-16 md:py-24 bg-fafafa">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-extrabold text-primary-dark text-center mb-12" data-i18n="h2-testimonials">
                What Our Clients Say
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-gray-500">
                    <i data-lucide="quote" class="w-8 h-8 text-gray-300 mb-3"></i>
                    <p class="text-gray-700 italic mb-4">"Rented from Casablanca airport. The process was smooth, and the car performed flawlessly across the Atlas Mountains. Excellent service!"</p>
                    <p class="font-semibold text-primary-dark">— Youssef H., Rabat</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-gray-500">
                    <i data-lucide="quote" class="w-8 h-8 text-gray-300 mb-3"></i>
                    <p class="text-gray-700 italic mb-4">"Friendly staff in Meknes, and the price was transparent—no hidden costs. **BLACK IRIS cars** made my trip worry-free. They delivered the car promptly."</p>
                    <p class="font-semibold text-primary-dark">— Hino G., Meknes</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-gray-500">
                    <i data-lucide="quote" class="w-8 h-8 text-gray-300 mb-3"></i>
                    <p class="text-gray-700 italic mb-4">"Needed a last-minute SUV in Tangier. The booking was confirmed instantly. The vehicle was clean and modern. Highly recommend this company."</p>
                    <p class="font-semibold text-primary-dark">— Amine B., UK</p>
                </div>
            </div>
        </div>
    </section>

    ---

    <footer id="contact" class="primary-dark text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 border-b border-gray-700 pb-8 mb-8">
                <div>
                    <h3 class="text-2xl font-extrabold mb-4 text-gray-300">BLACK IRIS cars</h3>
                    <p class="text-gray-400 text-sm">Your reliable partner for car rentals across Morocco.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4" data-i18n="h4-nav">Quick Navigation</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#featured" class="hover:text-accent-blue transition duration-150" data-i18n="nav-fleet">Our Fleet</a></li>
                        <li><a href="#why-us" class="hover:text-accent-blue transition duration-150" data-i18n="nav-why">Our Promise</a></li>
                        <li><a href="#testimonials" class="hover:text-accent-blue transition duration-150" data-i18n="nav-reviews">Customer Reviews</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4" data-i18n="h4-contact">Contact & Booking</h4>
                    <a href="tel:+212602020402" class="text-sm text-gray-400 mb-2 flex items-center ltr:justify-start hover:text-accent-blue transition duration-150">
                        <i data-lucide="phone" class="w-4 h-4 ltr:mr-2 text-accent-blue ltr:mr-2 ltr:ml-0 ltr:mr-2"></i> 0602020402
                    </a>
                    <p class="text-sm text-gray-400 mb-2 flex items-center ltr:justify-start"><i data-lucide="mail" class="w-4 h-4 ltr:mr-2 text-accent-blue ltr:mr-2 ltr:ml-0 ltr:mr-2"></i> <a href="mailto:blackiriscars@gmail.com" class="hover:text-accent-blue">blackiriscars@gmail.com</a></p>
                    <p class="text-sm text-gray-400 mb-2 flex items-center ltr:justify-start"><i data-lucide="map-pin" class="w-4 h-4 ltr:mr-2 text-accent-blue ltr:mr-2 ltr:ml-0 ltr:mr-2"></i> <span data-i18n="address-text">10 rue ouarzazat hassan rabat</span></p>
                    <a href="https://wa.me/212602020402" target="_blank" class="text-sm text-white px-3 py-1 mt-2 inline-flex items-center rounded-lg bg-green-600 hover:bg-green-700 transition duration-150">
                        <i data-lucide="message-circle" class="w-4 h-4 ltr:mr-2 ltr:ml-0 ltr:mr-2"></i> <span data-i18n="whatsapp-text">WhatsApp</span> 0602020402
                    </a>
                </div>
            </div>
            <div class="text-center text-sm text-gray-500 pt-4">
                &copy; <span data-i18n="copy-right">2024 BLACK IRIS cars. All rights reserved.</span>
            </div>
        </div>
    </footer>

    <div id="car-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center hidden">
        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-lg m-4 transform transition-all duration-300 scale-95 opacity-0" id="modal-detail-content">
            <div class="flex justify-between items-start mb-4">
                <h3 id="modal-car-name" class="text-2xl font-bold text-primary-dark">Car Name</h3>
                <button id="close-detail-modal-btn" class="text-gray-500 hover:text-primary-dark">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <img id="modal-car-image" src="" alt="Car Image" class="w-full h-48 object-cover rounded-lg mb-4 border border-gray-200">
                
                <div class="grid grid-cols-2 gap-4 text-sm text-gray-700">
                    
                    <div class="flex items-center ltr:justify-start">
                        <i data-lucide="car" class="w-4 h-4 ltr:mr-2 text-accent-blue"></i> 
                        <span id="modal-transmission" class="font-semibold"></span>
                    </div>

                    <div class="flex items-center ltr:justify-start">
                        <i data-lucide="users" class="w-4 h-4 ltr:mr-2 text-accent-blue"></i> 
                        <span id="modal-seats-value" class="font-semibold"></span> <span data-i18n="car-seats-label-spaced"> Seats</span>
                    </div>

                    <div class="flex items-center ltr:justify-start">
                        <i data-lucide="snowflake" class="w-4 h-4 ltr:mr-2 text-accent-blue"></i> 
                        <span data-i18n="modal-ac-label-short">A/C</span>
                    </div>

                    <div class="flex items-center ltr:justify-start">
                        <i data-lucide="paint-bucket" class="w-4 h-4 ltr:mr-2 text-accent-blue"></i> 
                        <span id="modal-color" class="font-semibold"></span>
                    </div>

                </div>

                <p id="modal-car-desc" class="text-gray-600 border-t border-gray-100 pt-4" data-i18n="modal-car-desc"></p>
            </div>

            <div class="flex justify-between items-center mt-6 pt-4 border-t">
                <span class="text-2xl font-extrabold text-primary-dark"><span id="modal-car-price"></span> DH <span class="text-base font-normal text-gray-500" data-i18n="car-day">/ day</span></span>
                <button id="modal-book-button" class="accent-blue text-white font-semibold py-2 px-6 rounded-lg hover:accent-blue-dark transition duration-300 shadow-md" data-i18n="btn-book-now">
                    Book Now
                </button>
            </div>

            <div id="contact-options" class="space-y-4 mt-6 border-t pt-4 hidden">
                <p class="text-gray-700 text-sm font-semibold text-center" data-i18n="modal-p">Choose contact method:</p>
                <a id="whatsapp-link" href="#" target="_blank" class="w-full flex items-center justify-center btn-whatsapp-green text-white font-semibold py-3 px-6 rounded-lg hover:btn-whatsapp-dark transition duration-300 shadow-md">
                    <i data-lucide="message-circle" class="w-5 h-5 ltr:mr-3"></i> <span data-i18n="btn-whatsapp">WhatsApp</span>
                </a>
                <a id="email-link" href="#" class="w-full flex items-center justify-center btn-email-blue text-white font-semibold py-3 px-6 rounded-lg hover:btn-email-dark transition duration-300 shadow-md">
                    <i data-lucide="mail" class="w-5 h-5 ltr:mr-3"></i> <span data-i18n="btn-email">Email</span>
                </a>
            </div>
        </div>
    </div>


    <script>
        // Initialize Lucide Icons
        lucide.createIcons();
        
        // Ensure global variables are set (using data loaded from data.js)
        let currentLang = 'en';

        function getTranslation(key) {
            // Check if key is a string property or a function (template)
            const translation = translations[currentLang][key];
            if (typeof translation === 'function') {
                return translation; 
            }
            return translation || key;
        }

        function setLanguage(lang) {
            currentLang = lang;
            const dictionary = translations[lang];
            
            // 1. Update text content
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (dictionary[key] && typeof dictionary[key] === 'string') {
                    element.textContent = dictionary[key];
                }
            });

            // 2. Handle RTL (Right-to-Left)
            const body = document.body;
            if (lang === 'ar') {
                body.setAttribute('dir', 'rtl');
            } else {
                body.setAttribute('dir', 'ltr');
            }
            // Update title
            document.title = 'BLACK IRIS cars - ' + (lang === 'ar' ? ' استئجار سيارة' : 'Car Rental');

            // 3. Reset select options for correct language display
            document.querySelectorAll('select option').forEach(option => {
                const key = option.getAttribute('data-i18n');
                if (key && dictionary[key] && typeof dictionary[key] === 'string') {
                    option.textContent = dictionary[key];
                }
            });
            
            // Re-render car grids to apply translated transmission text
            renderCarGrid('featured-car-grid', 10);

            // Re-render icons after language change
            lucide.createIcons();
        }

        const languageSelector = document.getElementById('language-selector');
        languageSelector.addEventListener('change', (event) => {
            setLanguage(event.target.value);
            localStorage.setItem('languagePreference', event.target.value);
        });

        // --- Date Functions (Reusable) ---
        
        function getFormattedDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function initializeDateFields() {
            const pickupInput = document.getElementById('pickup-date');
            const returnInput = document.getElementById('return-date');

            const now = new Date();
            const minDate = getFormattedDate(now);
            
            pickupInput.min = minDate;
            returnInput.min = minDate;

            pickupInput.addEventListener('change', () => {
                const pickupDate = pickupInput.value;
                if (!pickupDate) return;
                
                const pickupTime = new Date(pickupDate).getTime();
                const minReturnDateObj = new Date(pickupTime + (24 * 60 * 60 * 1000));
                const minReturnDate = getFormattedDate(minReturnDateObj);
                
                returnInput.min = minReturnDate;

                if (!returnInput.value || returnInput.value < minReturnDate) {
                    returnInput.value = minReturnDate;
                }
            });
        }

        // Load language preference and initialize dates on page load
        document.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('languagePreference') || 'en';
            languageSelector.value = savedLang;
            setLanguage(savedLang);
            initializeDateFields();
        });


        // --- CAR GRID RENDERING (Unified function) ---
        function renderCarGrid(gridId, limit) {
            const carGrid = document.getElementById(gridId);
            if (!carGrid) return;

            carGrid.innerHTML = ''; // Clear existing content
            
            const carsToDisplay = carData.slice(0, limit);

            carsToDisplay.forEach(car => {
                const transmissionText = getTranslation(car.transmission.toLowerCase());
                
                const carCard = document.createElement('div');
                carCard.className = `car-card bg-white rounded-xl shadow-lg overflow-hidden border-2 border-gray-100 cursor-pointer hover:shadow-xl transition duration-200`;
                carCard.setAttribute('data-car-id', car.id);
                
                carCard.innerHTML = `
                    <img src="${car.img}" alt="${car.name} ${car.color}" class="w-full h-24 sm:h-32 object-cover">
                    <div class="p-3 text-center">
                        <h3 class="text-sm font-bold text-gray-800">${car.name} (${transmissionText})</h3>
                        <p class="text-gray-500 text-xs">${car.price} DH<span data-i18n="car-day" class="car-day-text"> ${getTranslation('car-day')}</span></p>
                    </div>
                `;
                
                carGrid.appendChild(carCard);
            });
            
            // Only attach new listeners if the card is in the DOM
            attachCarCardListeners();
            
            // Ensure icons are created for the newly added content
            lucide.createIcons();
        }


        // --- CAR DETAIL MODAL LOGIC ---
        const detailModal = document.getElementById('car-detail-modal');
        const modalDetailContent = document.getElementById('modal-detail-content');
        const closeDetailModalBtn = document.getElementById('close-detail-modal-btn');
        const modalBookButton = document.getElementById('modal-book-button');
        const contactOptions = document.getElementById('contact-options');
        const whatsappLink = document.getElementById('whatsapp-link');
        const emailLink = document.getElementById('email-link');

        function openCarDetailModal(car) {
             const currentLang = languageSelector.value;

            // Populate modal content
            const transmissionText = getTranslation(car.transmission.toLowerCase());
            document.getElementById('modal-car-name').textContent = `${car.name} (${transmissionText})`;
            document.getElementById('modal-car-image').src = car.img;
            
            // Set dynamic details
            document.getElementById('modal-transmission').textContent = transmissionText;
            document.getElementById('modal-seats-value').textContent = car.seats;
            document.getElementById('modal-color').textContent = car.color;
            document.getElementById('modal-car-desc').textContent = car.desc;
            document.getElementById('modal-car-price').textContent = car.price;

            // Hide contact options initially
            contactOptions.classList.add('hidden');
            modalBookButton.classList.remove('hidden'); 
            
            // CRITICAL FIX: Use the CONCISE message template
            modalBookButton.onclick = () => showContactOptionsConcise(car.name, `${car.price} DH`);
            
            // Apply current translations to modal text elements
            setLanguage(currentLang);
            document.querySelector('[data-i18n="car-seats-label-spaced"]').textContent = getTranslation('car-seats-label-spaced');

            // Display Modal with animation
            detailModal.classList.remove('hidden');
            setTimeout(() => {
                modalDetailContent.classList.remove('scale-95', 'opacity-0');
            }, 10);
            document.body.classList.add('overflow-hidden');
        }

        // --- CORE LOGIC: Dynamic Message Generator (CONCISE for Index Page) ---
        function showContactOptionsConcise(carName, carPrice) {
            const currentLang = languageSelector.value;
            const dict = translations[currentLang];

            // 1. Use the localized CONCISE template functions (no dates/city needed)
            const whatsappMessage = dict['book-whatsapp-msg-concise'](carName, carPrice);
            const emailSubject = dict['book-email-subj-concise'](carName);
            const emailBody = dict['book-email-body-concise'](carName, carPrice);

            // 2. Set Link HREFs (URL encoding is crucial)
            whatsappLink.href = `https://wa.me/212602020402?text=${encodeURIComponent(whatsappMessage)}`;
            emailLink.href = `mailto:blackiriscars@gmail.com?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
            
            // 3. Update Modal Display
            contactOptions.classList.remove('hidden');
            modalBookButton.classList.add('hidden');
        }

        function closeCarDetailModal() {
            modalDetailContent.classList.add('scale-95', 'opacity-0');
            modalBookButton.classList.remove('hidden'); // Reset 'Book Now' button state
            setTimeout(() => {
                detailModal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }, 300);
        }

        function attachCarCardListeners() {
            document.querySelectorAll('.car-card').forEach(card => {
                card.removeEventListener('click', handleCardClick);
                card.addEventListener('click', handleCardClick);
            });
        }
        
        function handleCardClick(event) {
            const carId = parseInt(event.currentTarget.getAttribute('data-car-id'));
            const car = carData.find(c => c.id === carId);
            if (car) {
                openCarDetailModal(car);
            }
        }
        
        // Initial rendering for Featured Fleet (Top 10 cars)
        renderCarGrid('featured-car-grid', 10);
        
        // Attach close listeners
        closeDetailModalBtn.addEventListener('click', closeCarDetailModal);
        detailModal.addEventListener('click', (e) => {
            if (e.target === detailModal) {
                closeCarDetailModal();
            }
        });


        // --- MOBILE MENU TOGGLE ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
            });
        });

        // --- FORM SUBMISSION HANDLER (Validation and Instant Redirect) ---
        const rentalForm = document.getElementById('rental-form');
        const resultMessage = document.getElementById('result-message');

        rentalForm.addEventListener('submit', function(event) {
            event.preventDefault(); 

            const location = document.getElementById('location').value;
            const pickupDate = document.getElementById('pickup-date').value;
            const returnDate = document.getElementById('return-date').value;

            // ... (validation logic remains the same)

            const pickupTime = new Date(pickupDate).getTime();
            const returnTime = new Date(returnDate).getTime();
            const nowTime = new Date(getFormattedDate(new Date())).getTime();
            const oneDayInMs = 24 * 60 * 60 * 1000;

            let errorMessage = '';

            if (!location || !pickupDate || !returnDate) {
                errorMessage = '<strong>Error!</strong> Please select a pick-up city/airport and complete the date range.';
            } else if (pickupTime < nowTime) { 
                errorMessage = '<strong>Error! Choose an available date.</strong>';
            } else if (returnTime < pickupTime + oneDayInMs) {
                errorMessage = '<strong>Error! Choose an available date.</strong>';
            }

            if (errorMessage) {
                resultMessage.classList.remove('hidden', 'bg-green-100', 'border-green-400', 'text-green-700');
                resultMessage.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
                resultMessage.innerHTML = errorMessage;

                setTimeout(() => {
                    resultMessage.classList.add('hidden');
                }, 5000);
                return;
            }
            
            // --- VALIDATION SUCCESS: INSTANT REDIRECT ---
            
            // Store search parameters in localStorage for use on available_cars.html
            const selectedLocationText = document.getElementById('location').options[document.getElementById('location').selectedIndex].text;

            localStorage.setItem('rentalLocation', selectedLocationText); 
            localStorage.setItem('rentalPickupDate', pickupDate);
            localStorage.setItem('rentalReturnDate', returnDate);

            // Corrected Redirect: using available_cars.html
            window.location.href = 'available_cars.html';
        });

    </script>
</body>
</html>
